$(document).ready(function(){$(document).mouseup(function(a){var b=$("#aio_up");if(!b.is(a.target)&&b.has(a.target).length===0){close_uploader()}});$("body").on("click",".f",function(){if($("#aio_up").data("multiple")===undefined){$(".f").not(this).removeClass("on")}$(this).toggleClass("on");if($(this).data("delete")!==""&&$(this).data("delete")!==undefined){if($(this).data("delete")===0){$("#aio_up .fd").addClass("disabled")}else{if($(this).data("delete")===1){$("#aio_up .fd").removeClass("disabled")}}}}).on("click",".fd",function(){var a=$(".f.on");if(a.length>0&&a.data("id")!==undefined&&a!==""){$.post(location.origin,{action:"file_delete",id:a.data("id")},function(b){if(b=JSON.parse(b)){uploader_notify(b[1]);if(b[0]===1){$(".f.on").remove()}}})}}).on("click","#aio_up .close",function(){close_uploader()}).on("change","#file_input",function(){var a=this.files;process_upload(a)}).bind("dragover",".file_modal",function(a){a.stopPropagation();a.preventDefault();$(this).addClass("hover")}).bind("dragleave",".file_modal",function(a){a.stopPropagation();a.preventDefault();$(this).removeClass("hover")}).bind("drop",".file_modal",function(a){a.stopPropagation();a.preventDefault()}).on("click","#aio_up .fi",function(){var h=$("#aio_up");var e=$("#aio_up .f.on");if(h.data("multiple")===undefined){var a=$("#aio_up").data("exts");if(a){a=a.split(",");var d=e.data("url").split(".")[e.data("url").split(".").length-1];if(a.indexOf(d)<0){uploader_notify("The file should be one of the extensions "+a);return}}if(h.data("s_img")!==undefined&&h.data("s_img")!==""){if(e){$(h.data("s_img")).html("").append('<img width="150" height="150" src="'+h.data("dir")+e.data("url")+'">')}}if(h.data("bg")!==undefined&&h.data("bg")!==""){if(e){$(h.data("bg")).css({"background-image":'url("'+h.data("dir")+e.data("url")+'")'})}}if(h.data("id")!==undefined&&h.data("id")!==""){if(e){$(h.data("id")).val(e.data("id"))}}if(h.data("url")!==undefined&&h.data("url")!==""){if(e){$(h.data("url")).val(e.data("url"))}}}else{var i=[];var c=[];$.each(e,function(j,f){i.push($(f).data("url"));c.push($(f).data("ids"))});i=i.join("|");c=c.join("|");var g=$(h.data("url"));var b=$(h.data("id"));i=g.val()!==""?g.val()+"|"+i:i;c=b.val()!==""?b.val()+"|"+c:c;$(h.data("url")).val(i);$(h.data("id")).val(c)}file_ui();files_ui();$("#aio_up").slideUp();setTimeout(function(){var f=e.length>0?"File Selected Successfully!":"NO FILE SELECTED! File Uploader Closed!!";$(".file_notify").html(f).addClass("on")},500);setTimeout(function(){$(".file_notify").removeClass("on")},1600)}).on("click","[data-file-upload]",function(){file_upload($(this))}).on("click",".aio_fsp .trash",function(){elog("test");var c=$(this).next(".f").html();if(c!==undefined&&c!==""&&confirm("Are you sure to remove attached file ?")){var a=$($(this).parents("[data-url]").data("url")).val().split("|");var b="";if($.isArray(a)){$(a).each(function(g,f){var e=f.split("/")[f.split("/").length-1];if(e!==c){b+=f+"|"}})}b=b.slice(0,-1);$($(this).parents("[data-url]").data("url")).val(b);files_ui()}}).on("click",".aio_fp .trash",function(){var a=$(this).next(".f").html();if(a!==undefined&&a!==""&&confirm("Are you sure to remove attached file ?")){$($(this).parents("[data-url]").data("url")).val("");file_ui()}})});function file_ui(){$("input[data-file]").each(function(c,g){$(g).hide();var h=$(g).val();var b=h.split("/")[h.split("/").length-1];var e=b.split(".")[b.split(".").length-1];var a=b!==""?'<div class="f"><i class="ico file '+e+'"></i><i class="ico trash"></i><div class="f">'+b+"</div></div>":$(g).prev("button").show().clone();if(!$(g).next().hasClass("aio_fp")){var j=$(g).prev("button").data("url");$(g).after('<div class="aio_fp" data-url="'+j+'"></div>')}$(g).next(".aio_fp").html(a);$(g).prev("button").hide()})}function files_ui(){$("input[data-files]").each(function(d,c){$(c).hide();var f=$(c).val()!==""?$(c).val().split("|"):"";var g="";$(f).each(function(j,i){var a=i.split("/")[i.split("/").length-1];var b=a.split(".")[a.split(".").length-1];g+=a!==""?'<div class="f"><i class="ico file '+b+'"></i><i class="ico trash"></i><div class="f">'+a+"</div></div>":""});g=g!==""?'<div class="w">'+g+"</div>":"";if(!$(c).next().hasClass("aio_fsp")){var h=$(c).prev("button").data("url");$(c).after('<div class="aio_fsp" data-url="'+h+'"></div>')}var e=!$(c).prop("disabled")?$(c).prev("button")[0].outerHTML:"test";elog(g);$(c).next(".aio_fsp").html(g+e);$(c).next(".aio_fsp").find("button").show().html("+");$(c).prev("button").hide()})}function file_upload(a){var b=$("#aio_up");if(($(a).data("url")!==""&&$(a).data("url")!==undefined)||($(a).data("id")!==""&&$(a).data("id")!==undefined)){if($(a).data("history")===undefined){$("#aio_up .f").hide();$(".fb").click()}else{$("#aio_up .f").show()}if(!b.is(":visible")){b.slideDown()}b.data("exts",$(a).data("exts")).data("files",$(a).data("files")).data("url",$(a).data("url")).data("multiple",$(a).data("multiple")).data("bg",$(a).data("bg")).data("id",$(a).data("id")).data("s_img",$(a).data("s_img")).data("path",$(a).data("path")).data("scope",$(a).data("scope"));if(b.data("multiple")!==undefined){$(".fi").addClass("multiple")}else{$(".fi").removeClass("multiple")}if($(a).data("delete")===undefined){$(".fd").hide();b.data("delete",false)}else{$(".fd").show();b.data("delete",true)}if($(a).data("title")!==undefined){$("#aio_up h3").html($(a).data("title"))}}}function process_upload(a){for(var c=0,g;g=a[c];c++){var b=$("#aio_up").data("exts");if(b){b=b.split(",");var e=g.name.split(".")[1];if(b.indexOf(e)<0){uploader_notify("The file should be one of the extensions "+b);return[false,"Extension Restricted","The file should be one of the extensions "+b]}}var h=new FormData();h.append(c,g);h.append("action","file_process");if($("#aio_up").data("path")!==""&&$("#aio_up").data("path")!==undefined){h.append("path",$("#aio_up").data("path"))}if($("#aio_up").data("scope")!==""&&$("#aio_up").data("scope")!==undefined){h.append("scope",$("#aio_up").data("scope"))}if($("#aio_up").data("delete")!==""&&$("#aio_up").data("delete")!==undefined&&$("#aio_up").data("delete")){h.append("delete","true")}else{h.append("delete","false")}$("#aio_up .uploaded_files").prepend('<div class="uploading"><div class="name">'+g.name+'</div><div class="perc"><span>0</span>%</div><div class="progress"><div></div></div></div>');$.ajax({url:location.origin,type:"POST",data:h,contentType:false,cache:false,processData:false,xhr:function(){var d=$.ajaxSettings.xhr();if(d.upload){d.upload.addEventListener("progress",upload_progress,false)}return d},success:function(k){$("#aio_up .uploading").remove();var l=$.parseJSON(k);if(l[0]==="success"){$("#aio_up .no_uploaded_files").remove();var j=parseInt(l[6])>1024?(parseFloat(l[6])/1024).toFixed(2)+" MB":l[6]+" KB";var i=$.inArray(l[5],Array("svg","jpg","png","jpeg"))>-1?"style=\"background-image:url('"+l[7]+"')\"":"";var f=l[8]===1?'data-delete="1"':'data-delete="0"';$("#aio_up .uploaded_files").prepend('<div class="fup_file new '+l[5]+'" data-id="'+l[4]+'" data-url="'+l[3]+'" '+i+" "+f+'><div class="name">'+l[2]+'</div><div class="size">'+j+"</div></div>");$("#aio_up .f").removeClass("on");uploader_notify("File Uploaded Successfully!");setTimeout(function(){$(".f").removeClass("new")},1000);if($("#aio_up").data("files")===undefined){$(".f.new").addClass("on");$(".fi").click()}return[true,"File Uploaded Successfully",l]}else{return[true,"File Uploaded Failed","There was an issue while sending file to server, please try again"]}}})}}function upload_progress(d){if(d.lengthComputable){var a=d.total;var c=d.loaded;var b=Math.round((c*100)/a);$("#aio_up .progress>div").css({width:b+"%"});$("#aio_up .uploading .perc>span").html(b);if(b>=100){}}}function uploader_notify(a){$(".file_notify").html(a).addClass("on");setTimeout(function(){$(".file_notify").removeClass("on")},2000)}function close_uploader(){$(".f").removeClass("on");$("#aio_up").slideUp().removeData(["id","url","exts","s_img","scope","path","bg","multiple","files"])};