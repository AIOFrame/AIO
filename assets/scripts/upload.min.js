$(document).ready(function(){$(document).mouseup(function(a){var b=$("#aio_up");if(!b.is(a.target)&&b.has(a.target).length===0){close_uploader()}});$("body").on("click",".f",function(){if($("#aio_up").data("multiple")===undefined){$(".f").not(this).removeClass("on")}$(this).toggleClass("on");if($(this).data("delete")!==""&&$(this).data("delete")!==undefined){if($(this).data("delete")===0){$("#aio_up .fd").addClass("disabled")}else{if($(this).data("delete")===1){$("#aio_up .fd").removeClass("disabled")}}}}).on("click",".fd",function(){var a=$(".f.on");if(a.length>0&&a.data("id")!==undefined&&a!==""){$.post(location.origin,{action:"file_delete",id:a.data("id")},function(b){if(b=JSON.parse(b)){uploader_notify(b[1]);if(b[0]===1){$(".f.on").remove()}}})}}).on("click","#aio_up .close",function(){close_uploader()}).on("keyup",function(a){if($("#aio_up").hasClass("on")&&a.key==="Escape"){close_uploader()}}).on("click","[data-upload]",function(a){file_upload(a.target)}).on("change","#file_input",function(){var a=this.files;process_upload(a)}).on("click","#aio_up .fi",function(){var h=$("#aio_up");var j=$("#aio_up .f.on");if(h.data("multiple")===undefined){var e=$("#aio_up").data("exts");if(e){e=e.split(",");var b=j.data("url").split(".")[j.data("url").split(".").length-1];if(e.indexOf(b)<0){var c=$("#aio_up .extension_limit").html();uploader_notify(c+" <strong>"+e+"</strong>");return}}if(h.data("s_img")!==undefined&&h.data("s_img")!==""){if(j){$(h.data("s_img")).html("").append('<img width="150" height="150" src="'+h.data("dir")+j.data("url")+'">')}}if(h.data("bg")!==undefined&&h.data("bg")!==""){if(j){$(h.data("bg")).css({"background-image":'url("'+h.data("dir")+j.data("url")+'")'})}}if(h.data("id")!==undefined&&h.data("id")!==""){if(j){$(h.data("id")).val(j.data("id"))}}if(h.data("url")!==undefined&&h.data("url")!==""){if(j){$(h.data("url")).val(j.data("url"))}}if(h.data("callback")!==undefined&&h.data("callback")!==""){}}else{var i=[];var a=[];$.each(j,function(k,f){i.push($(f).data("url"));a.push($(f).data("ids"))});i=i.join("|");a=a.join("|");var d=$(h.data("url"));var g=$(h.data("id"));$(h.data("url")).val(i);$(h.data("id")).val(a)}file_ui();files_ui();$("#aio_up").slideUp().addClass("on");setTimeout(function(){var f=j.length>0?$("#aio_up .file_select").html():$("#aio_up .no_file_select").html();$(".file_notify").html(f).addClass("on")},500);setTimeout(function(){$(".file_notify").removeClass("on")},1600)}).on("click",".aio_fsp .trash",function(){var c=$(this).next(".f").html();if(c!==undefined&&c!==""&&confirm($("#aio_up .remove_confirm").html())){var a=$($(this).parents("[data-url]").data("url")).val().split("|");var b="";if($.isArray(a)){$(a).each(function(g,f){var e=f.split("/")[f.split("/").length-1];if(e!==c){b+=f+"|"}})}b=b.slice(0,-1);$($(this).parents("[data-url]").data("url")).val(b);files_ui()}}).on("click",".aio_fp .trash",function(){var a=$(this).next(".f").html();if(a!==undefined&&a!==""&&confirm($("#aio_up .remove_confirm").html())){$($(this).parents("[data-url]").data("url")).val("");file_ui()}});$("#aio_up .files_body").bind("dragover",".file_modal",function(a){a.stopPropagation();a.preventDefault();$(this).addClass("hover")}).bind("dragleave",".file_modal",function(a){a.stopPropagation();a.preventDefault();$(this).removeClass("hover")}).bind("drop",".file_modal",function(a){a.stopPropagation();a.preventDefault();process_upload(a.originalEvent.dataTransfer.files);$(this).removeClass("hover")});$("#aio_up .search").on("search keyup",function(){var a=$(this).val().toLowerCase();$("#aio_up .uploaded_files .f").each(function(d,c){if($(c).find(".name").html().toLowerCase().indexOf(a)>=0){$(c).show()}else{$(c).hide()}})});file_ui();files_ui()});function file_ui(){$("input[data-file]").each(function(g,j){$(j).hide();var k=$(j).val();var h=$(j).attr("readonly")!==undefined;var e=k.split("/")[k.split("/").length-1];var b=e.split(".")[e.split(".").length-1];var l=!h?'<i class="ico trash"></i>':"";var c=e!==""?'<div class="f"><i class="ico file '+b+'"></i>'+l+'<div class="f">'+e+"</div></div>":$(j).prev("button").show().clone();if(!$(j).next().hasClass("aio_fp")){var a=$(j).prev("button").data("url");$(j).after('<div class="aio_fp aio_files" data-url="'+a+'"></div>')}$(j).next(".aio_fp").html(c);$(j).prev("button").hide()})}function files_ui(){$("input[data-files]").each(function(d,c){$(c).hide();var h=$(c).val()!==""?$(c).val().split("|"):"";var i="";var e=$(c).attr("readonly")!==undefined;var g=!e?'<i class="ico trash"></i>':"";$(h).each(function(l,k){var a=k.split("/")[k.split("/").length-1];var b=a.split(".")[a.split(".").length-1];if(e){i+=a!==""?'<a href="'+location.origin+"/apps/"+location.host.split(".")[0]+k+'" class="f"><i class="ico file '+b+'"></i>'+g+'<div class="f">'+a+"</div></a>":""}else{i+=a!==""?'<div class="f"><i class="ico file '+b+'"></i>'+g+'<div class="f">'+a+"</div></div>":""}});i=i!==""?'<div class="w">'+i+"</div>":"";if(!$(c).next().hasClass("aio_fsp")){var j=$(c).prev("button").data("url");$(c).after('<div class="aio_fsp aio_files" data-url="'+j+'"></div>')}var f=!$(c).prop("disabled")?$(c).prev("button")[0].outerHTML:"";$(c).next(".aio_fsp").html(i+f);if(!e){$(c).next(".aio_fsp").find("button").show().html("+")}else{$(c).next(".aio_fsp").find("button").hide()}if($(c).data("color")!==undefined&&$(c).data("color")!==""){$(".aio_fsp button").css({"background-color":$(c).data("color")})}$(c).prev("button").hide()})}function file_upload(b){var d=$("#aio_up");if(($(b).data("url")!==""&&$(b).data("url")!==undefined)||($(b).data("id")!==""&&$(b).data("id")!==undefined)){if($(b).data("history")===undefined){$("#aio_up .f").hide();$(".fb").click()}else{if($(b).data("force-browse")!==undefined){$(".fb").click()}$("#aio_up .f").show()}var c=$("#aio_up .files_head h3");if($(b).data("color")!==undefined&&$(b).data("color")!==""){c.css({"background-color":$(b).data("color")})}else{c.css({"background-color":"#333"})}if($(b).data("title")!==undefined&&$(b).data("title")!==""){$("#aio_up").data("title_backup",c.html());c.html($(b).data("title"))}else{c.html($("#aio_up").data("title_backup"))}if(!d.is(":visible")){d.slideDown().addClass("on")}$.each($(b).data(),function(f,e){d.data(f,e)});if(d.data("multiple")!==undefined){$(".fi").addClass("multiple")}else{$(".fi").removeClass("multiple")}if($(b).data("delete")===undefined){$(".fd").hide();d.data("delete",false)}else{$(".fd").show();d.data("delete",true)}if($($(b).data("url")).val()!==""){var a=$($(b).data("url")).val().split("|");$("#aio_up .f").removeClass("on");$.each(a,function(e,f){$('#aio_up .f[data-url="'+f+'"]').addClass("on")})}}}function process_upload(a){for(var c=0,g;g=a[c];c++){var b=$("#aio_up").data("exts");if(b){b=b.split(",");var e=g.name.split(".")[1];if(b.indexOf(e)<0){var j=$("#aio_up .extension_limit").html();uploader_notify(j+" <strong>"+b+"</strong>");return[false,"Extension Restricted","The file should be one of the extensions "+b]}}var h=new FormData();h.append(c,g);h.append("action","file_process");if($("#aio_up").data("path")!==""&&$("#aio_up").data("path")!==undefined){h.append("path",$("#aio_up").data("path"))}if($("#aio_up").data("scope")!==""&&$("#aio_up").data("scope")!==undefined){h.append("scope",$("#aio_up").data("scope"))}if($("#aio_up").data("delete")!==""&&$("#aio_up").data("delete")!==undefined&&$("#aio_up").data("delete")){h.append("delete","true")}else{h.append("delete","false")}$("#aio_up .uploaded_files").prepend('<div class="uploading"><div class="name">'+g.name+'</div><div class="perc"><span>0</span>%</div><div class="progress"><div></div></div></div>');$.ajax({url:location.origin,type:"POST",data:h,contentType:false,cache:false,processData:false,xhr:function(){var d=$.ajaxSettings.xhr();if(d.upload){d.upload.addEventListener("progress",upload_progress,false)}return d},success:function(l){console.log(l);$("#aio_up .uploading").remove();var m=$.parseJSON(l);if(m[0]==="success"){$("#aio_up .no_uploaded_files").remove();var k=parseInt(m[6])>1024?(parseFloat(m[6])/1024).toFixed(2)+" MB":m[6]+" KB";var i=$.inArray(m[5],Array("svg","jpg","png","jpeg"))>-1?"style=\"background-image:url('"+m[7]+"')\"":"";var f=m[8]===1?'data-delete="1"':'data-delete="0"';$("#aio_up .uploaded_files").prepend('<div class="f new '+m[5]+'" data-id="'+m[4]+'" data-url="'+m[3]+'" '+i+" "+f+'><div class="name">'+m[2]+'</div><div class="size">'+k+"</div></div>");$("#aio_up .f").removeClass("on");uploader_notify($("#aio_up .upload_success").html());setTimeout(function(){$(".f").removeClass("new")},1000);if($("#aio_up").data("files")===undefined){$(".f.new").addClass("on");$(".fi").click()}return[1,$("#aio_up .upload_success").html(),m]}else{uploader_notify(r[1]);return[1,"File Uploaded Failed","There was an issue while sending file to server, please try again"]}}})}}function upload_progress(d){if(d.lengthComputable){var a=d.total;var c=d.loaded;var b=Math.round((c*100)/a);$("#aio_up .progress>div").css({width:b+"%"});$("#aio_up .uploading .perc>span").html(b)}}function uploader_notify(a){$(".file_notify").html(a).addClass("on");setTimeout(function(){$(".file_notify").removeClass("on")},2000)}function close_uploader(){$(".f").removeClass("on");$("#aio_up").slideUp().removeClass("on").removeData(["id","url","exts","s_img","scope","path","bg","multiple","files"])};