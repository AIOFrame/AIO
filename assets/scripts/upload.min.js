$(document).ready(function(){$(document).mouseup(function(a){var b=$("#file_uploader");if(!b.is(a.target)&&b.has(a.target).length===0){close_uploader()}});$("body").on("click",".fup_file",function(){if($("#file_uploader").data("multiple")===undefined){$(".fup_file").not(this).removeClass("on")}$(this).toggleClass("on");if($(this).data("delete")!==""&&$(this).data("delete")!==undefined){if($(this).data("delete")===0){$("#file_uploader .files_delete").addClass("disabled")}else{if($(this).data("delete")===1){$("#file_uploader .files_delete").removeClass("disabled")}}}}).on("click",".files_delete",function(){var a=$(".fup_file.on");if(a.length>0&&a.data("id")!==undefined&&a!==""){$.post(location.origin,{action:"file_delete",id:a.data("id")},function(b){if(b=JSON.parse(b)){uploader_notify(b[1]);if(b[0]===1){$(".fup_file.on").remove()}}})}}).on("click","#file_uploader .close",function(){close_uploader()}).on("change","#file_input",function(){var a=this.files;process_upload(a)}).bind("dragover",".file_modal",function(a){a.stopPropagation();a.preventDefault();$(this).addClass("hover")}).bind("dragleave",".file_modal",function(a){a.stopPropagation();a.preventDefault();$(this).removeClass("hover")}).bind("drop",".file_modal",function(){e.stopPropagation();e.preventDefault()}).on("click","#file_uploader .files_insert",function(){var i=$("#file_uploader");var g=$("#file_uploader .fup_file.on");if(i.data("multiple")===undefined){var a=$("#file_uploader").data("exts");if(a){a=a.split(",");var d=g.data("url").split(".")[g.data("url").split(".").length-1];if(a.indexOf(d)<0){uploader_notify("The file should be one of the extensions "+a);return}}if(i.data("s_img")!==undefined&&i.data("s_img")!==""){if(g){$(i.data("s_img")).html("").append('<img width="150" height="150" src="'+i.data("dir")+g.data("url")+'">')}}if(i.data("bg")!==undefined&&i.data("bg")!==""){if(g){$(i.data("bg")).css({"background-image":'url("'+i.data("dir")+g.data("url")+'")'})}}if(i.data("id")!==undefined&&i.data("id")!==""){if(g){$(i.data("id")).val(g.data("id"))}}if(i.data("url")!==undefined&&i.data("url")!==""){if(g){$(i.data("url")).val(g.data("url"))}}}else{var j=[];var c=[];$.each(g,function(k,f){j.push($(f).data("url"));c.push($(f).data("ids"))});j=j.join("|");c=c.join("|");var h=$(i.data("url"));var b=$(i.data("id"));j=h.val()!==""?h.val()+"|"+j:j;c=b.val()!==""?b.val()+"|"+c:c;$(i.data("url")).val(j);$(i.data("id")).val(c)}file_ui();files_ui();$("#file_uploader").slideUp();setTimeout(function(){var f=g.length>0?"File Selected Successfully!":"NO FILE SELECTED! File Uploader Closed!!";$(".file_notify").html(f).addClass("on")},500);setTimeout(function(){$(".file_notify").removeClass("on")},1600)}).on("click","[data-file-upload]",function(){file_upload($(this))})});function file_upload(a){var b=$("#file_uploader");if(($(a).data("url")!==""&&$(a).data("url")!==undefined)||($(a).data("id")!==""&&$(a).data("id")!==undefined)){if($(a).data("history")===undefined){$("#file_uploader .fup_file").hide();$(".files_browse").click()}else{$("#file_uploader .fup_file").show()}if(!b.is(":visible")){b.slideDown()}b.data("exts",$(a).data("exts")).data("files",$(a).data("files")).data("url",$(a).data("url")).data("multiple",$(a).data("multiple")).data("bg",$(a).data("bg")).data("id",$(a).data("id")).data("s_img",$(a).data("s_img")).data("path",$(a).data("path")).data("scope",$(a).data("scope"));if(b.data("multiple")!==undefined){$(".files_insert").addClass("multiple")}else{$(".files_insert").removeClass("multiple")}if($(a).data("delete")===undefined){$(".files_delete").hide();b.data("delete",false)}else{$(".files_delete").show();b.data("delete",true)}}}function process_upload(a){for(var c=0,h;h=a[c];c++){var b=$("#file_uploader").data("exts");if(b){b=b.split(",");var g=h.name.split(".")[1];if(b.indexOf(g)<0){uploader_notify("The file should be one of the extensions "+b);return[false,"Extension Restricted","The file should be one of the extensions "+b]}}var j=new FormData();j.append(c,h);j.append("action","file_process");if($("#file_uploader").data("path")!==""&&$("#file_uploader").data("path")!==undefined){j.append("path",$("#file_uploader").data("path"))}if($("#file_uploader").data("scope")!==""&&$("#file_uploader").data("scope")!==undefined){j.append("scope",$("#file_uploader").data("scope"))}if($("#file_uploader").data("delete")!==""&&$("#file_uploader").data("delete")!==undefined&&$("#file_uploader").data("delete")){j.append("delete","true")}else{j.append("delete","false")}$("#file_uploader .uploaded_files").prepend('<div class="uploading"><div class="name">'+h.name+'</div><div class="perc"><span>0</span>%</div><div class="progress"><div></div></div></div>');$.ajax({url:location.origin,type:"POST",data:j,contentType:false,cache:false,processData:false,xhr:function(){var d=$.ajaxSettings.xhr();if(d.upload){d.upload.addEventListener("progress",upload_progress,false)}return d},success:function(l){$("#file_uploader .uploading").remove();var m=$.parseJSON(l);if(m[0]==="success"){$("#file_uploader .no_uploaded_files").remove();var k=parseInt(m[6])>1024?(parseFloat(m[6])/1024).toFixed(2)+" MB":m[6]+" KB";var i=$.inArray(m[5],Array("svg","jpg","png","jpeg"))>-1?"style=\"background-image:url('"+m[7]+"')\"":"";var f=m[8]===1?'data-delete="1"':'data-delete="0"';$("#file_uploader .uploaded_files").prepend('<div class="fup_file new '+m[5]+'" data-id="'+m[4]+'" data-url="'+m[3]+'" '+i+" "+f+'><div class="name">'+m[2]+'</div><div class="size">'+k+"</div></div>");$("#file_uploader .fup_file").removeClass("on");uploader_notify("File Uploaded Successfully!");setTimeout(function(){$(".fup_file").removeClass("new")},1000);if($("#file_uploader").data("files")===undefined){$(".fup_file.new").addClass("on");$(".files_insert").click()}return[true,"File Uploaded Successfully",m]}else{return[true,"File Uploaded Failed","There was an issue while sending file to server, please try again"]}}})}}function upload_progress(d){if(d.lengthComputable){var a=d.total;var c=d.loaded;var b=Math.round((c*100)/a);$("#file_uploader .progress>div").css({width:b+"%"});$("#file_uploader .uploading .perc>span").html(b);if(b>=100){}}}function uploader_notify(a){$(".file_notify").html(a).addClass("on");setTimeout(function(){$(".file_notify").removeClass("on")},2000)}function close_uploader(){$(".fup_file").removeClass("on");$("#file_uploader").slideUp().removeData(["id","url","exts","s_img","scope","path","bg","multiple","files"])};