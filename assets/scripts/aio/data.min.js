if(typeof window.elog==="undefined"){window.elog=function(b){if($("body").hasClass("debug")){console.log(b)}}}$(document).ready(function(){$(document).on("change","[data-process-change],[data-change-action]",function(b){let action=$(this).data("process-change")!==undefined?$(this).data("change-action"):"";if(action!==""){post($(this).data("process-change"),{data:$(this).val()},"","","","",$(this).data("callback"))}});$(document).on("keyup","[data-enter-submit]",function(b){if(b.keyCode===13){process_data($(b).parents("[data-t]"))}}).on("change","[auto-post],[auto-process],[auto-submit]",function(){$($(this).parents("[data-t]")).find("[onclick]").click()})});function get_values(c,e,b){let a=e;a=a!==undefined&&a!==""?"[data-"+a+"]":"";let pre=b;pre=pre!==undefined&&pre!==""?pre:"";let data={};if($(c).data("dynamic")!==undefined){data[$(c).data("dynamic")]={};$.each($(c).children(".form"),function(f,g){data[$(c).data("dynamic")][f]=get_values($(g).attr("class").replaceAll("form row ","."),e,b)});return data}else{$(c).find(":input"+a+":not(:button)","select"+a,"textarea"+a).each(function(){let pre_key;let name=$(this).attr("name");name=name!==undefined?name.replace("[]",""):undefined;let key=$(this).data("key");let id=$(this).attr("id");if($(this).data("array")!==undefined){pre_key=pre+$(this).data("array")}else{if(key!==undefined){pre_key=pre+key}else{if(id!==undefined){pre_key=pre+id}else{if(name!==undefined){pre_key=pre+name}else{pre_key=pre+$(this).attr("class")}}}}let m=$(c).find("[name="+name+"]");let value;value=$(this).hasClass("fn")?ufn($(this).val()):$(this).val();if($(this).attr("type")==="checkbox"){let t=$(this).is(":checked");let arr=$(this).data("array");let keyed_arr=$(this).data("keyed-array");let v=$(this).val();if($(this).hasClass("slide")){value=$(this).is(":checked")?1:2}else{if(keyed_arr!==undefined){pre_key=key;if(data[pre+keyed_arr.replaceAll("[]","")]===undefined){data[pre+keyed_arr.replaceAll("[]","")]={};data[pre+keyed_arr.replaceAll("[]","")][pre_key]=[]}if(data[pre+keyed_arr.replaceAll("[]","")][pre_key]===undefined){data[pre+keyed_arr.replaceAll("[]","")][pre_key]=[]}if(t){data[pre+keyed_arr.replaceAll("[]","")][pre_key].push(v)}}else{if(arr!==undefined){if(data[pre_key]===undefined||!$.isArray(data[pre_key])){data[pre_key]=[]}if(t){data[pre_key].push(v)}}else{if(m.length>1){value=$("[name="+$(this).attr("name")+"]").map(function(){if(t){return $(this).val()}}).toArray()}else{value=t===true?1:2}}}}}else{if($(this).attr("type")==="radio"&&$("input[name="+$(this).attr("name")+"]:checked")){data[pre_key]=$("input[name="+$(this).attr("name")+"]:checked").val();return true}else{if($(this).is("select")&&$(this).attr("multiple")!==undefined){value=$(this).val().join(", ")}}}if($(this).data("array")!==undefined){let arr=$(this).data("array");key=$(this).val()!==""?$(this).attr("name"):"";key=key===""?$(this).attr("id"):key;let key2=$(this).data("key")!==undefined?$(this).data("key"):key;data[pre_key]=data[pre_key]===undefined?{}:data[pre_key];$(this).val()!==""?data[pre_key][key2]=value:""}else{if($(this).data("html-characters")!==undefined){data[pre_key]=html_to_text(value)}else{data[pre_key]=value}}});$.each(data,function(g,f){if(typeof f==="object"&&f!==null){data[g]=JSON.stringify(f)}})}return data}function get_checkbox_values(c,b){let d=[];$("[name="+c+"]").each(function(f,e){$(e).is(":checked")?d.push($(e).val()):""});if(b){return d.join(", ")}else{return d}}function email_valid(b){let v=_email_valid(b);!v?$(b).removeClass("empty"):$(b).addClass("empty");if(v&&$(b).data("valid-email-notify")!==undefined&&$(b).data("valid-email-notify")!==""){notify($(b).data("valid-email-notify"),5,"error","warning")}return v}function _email_valid(b){let pattern=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;return !pattern.test($(b).val())}function is_empty(b,c){c=c===undefined||c===""?"":c;let required=[];if($(b)[0]&&($(b)[0].localName==="div"||$(b)[0].localName==="tr"||$(b)[0].localName==="form")){$.each($(b).find("input"+c+",select"+c+",textarea"+c),function(f,e){if(e!==undefined){if($(e).attr("type")==="checkbox"||$(e).attr("type")==="radio"){if($(e).is(":checked")){$(e).removeClass("empty")}else{$(e).addClass("empty");required.push($(e).attr("title"))}}else{if($(e).val()!==null&&$(e).val()!==""){$(e).removeClass("empty")}else{$(e).addClass("empty");required.push($(e).attr("title"))}}}})}else{if($(b).val()!==null&&$(b).val()!==""){$(b).removeClass("empty")}else{$(b).addClass("empty");required.push($(b).attr("title"))}}return required}function validator(b,c){c=c===undefined||c===""?"":"[data-"+c+"]";let invalid=[];if($(b)[0]&&($(b)[0].localName==="div"||$(b)[0].localName==="tr"||$(b)[0].localName==="form")){invalid=[];$.each($(b).find("input"+c+",select"+c+",textarea"+c),function(f,e){let validation=valid_field(e);if(validation.length>0){invalid.push([$(e).attr("title"),validation]);$(e).addClass("invalid")}else{$(e).removeClass("invalid")}})}else{let validation=valid_field(b);if(validation.length>0){invalid.push([$(b).attr("title"),validation]);$(b).addClass("invalid")}else{$(b).removeClass("invalid")}}return invalid}function valid_field(b){let invalid_reasons=[];let min=$(b).attr("min");if($(b)!==undefined&&min!==undefined&&$(b).val()<parseInt(min)){let notice=$(b).data("min_notice");let message=notice!==undefined?notice.replaceAll("{min}",min):"Number should be more than "+min+"!";invalid_reasons.push(message)}let max=$(b).attr("max");if($(b)!==undefined&&max!==undefined&&$(b).val()>parseInt(max)){let notice=$(b).data("max_notice");let message=notice!==undefined?notice.replaceAll("{max}",min):"Number should be less than "+min+"!";invalid_reasons.push(message)}let minlength=$(b).attr("minlength");if($(b)!==undefined&&minlength!==undefined&&$(b).val().length<parseInt(minlength)){let notice=$(b).data("minlength_notice");let message=notice!==undefined?notice.replaceAll("{min}",min):"Char should be more than "+minlength+" characters!";invalid_reasons.push(message)}let maxlength=$(b).attr("maxlength");if($(b)!==undefined&&maxlength!==undefined&&$(b).val().length>parseInt(maxlength)){let notice=$(b).data("maxlength_notice");let message=notice!==undefined?notice.replaceAll("{max}",min):"Char should be less than "+maxlength+" characters!";invalid_reasons.push(message)}if($(b).attr("type")==="email"){if(_email_valid(b)){let notice=$(b).data("invalid_notice");let message=notice!==undefined?notice:"Email format is not valid!";invalid_reasons.push(message)}let domain=$(b).val().split("@")[1];let restrict_domains=$(b).data("restrict_domains");if($(b)!==undefined&&domain!==undefined&&restrict_domains!==undefined&&restrict_domains.indexOf(domain)>=0){let notice=$(b).data("restrict_domains_notice");let message=notice!==undefined?notice:"Email domain is restricted!";invalid_reasons.push(message)}}return invalid_reasons}function _is_empty(b,c){c=c===undefined||c===""?"":"[data-"+c+"]";if($(b)[0]&&($(b)[0].localName==="div"||$(b)[0].localName==="tr"||$(b)[0].localName==="form")){let r=[];$.each($(b).find("input"+c+",select"+c+",textarea"+c),function(f,e){if(e!==undefined&&$(e).val()!==null&&$(e).val()!==""){r.push(false)}else{elog(e);r.push(true)}});return $.inArray(true,r)!==-1}else{return $(b).val().length<=0}}function clear(b,c){if($(b)[0]&&($(b)[0].localName==="div"||$(b)[0].localName==="tr"||$(b)[0].localName==="form")){elog($(b)[0].localName);$.each($(b).find("input"+c+",select"+c+",textarea"+c),function(f,e){$(e).val("")})}else{$(b).val("")}}function process_data(c,b){console.log(c);console.log(b);let p=$(c).closest("[data-t]")!==undefined&&$(c).closest("[data-t]")!==null&&$(c).closest("[data-t]").length>0?$(c).closest("[data-t]"):$(c);if(p.hasClass("load")){return}if($(c).closest("[data-t]")!==undefined&&$(c).closest("[data-t]")!==null&&$(c).closest("[data-t]").length>0){$(p).find('[onclick="process_data(this)"]').attr("disabled",true).addClass("load");setTimeout(function(){$(p).removeClass("load").find('[onclick="process_data(this)"]').attr("disabled",false).removeClass("load")},5000)}else{$(p).attr("disabled",true).addClass("load");setTimeout(function(){$(p).attr("disabled",false).removeClass("load")},5000)}let con=$(p).data("confirm");if(con!==undefined&&con!==""){if(!confirm(con)){return}}p=(p.length!==0&&p[0].tagName==="DIV")?p:$(c).parents("[data-data]");p.addClass("load");let pre=$(p).data("pre");pre=pre!==undefined?pre:"";let data=$(p).data("data");data=data!==undefined?data:"";let breaker=[];let data_attr=data!==undefined&&data!==""?"[data-"+data+"]":"";let required=is_empty(p,data_attr+"[required]");if(required.length>0){$(p).removeClass("load");$(c).attr("disabled",false).removeClass("load");let empty_note=$(p).data("empty")!==undefined?$(p).data("empty"):"The highlighted fields seem to be empty!";empty_note+='<div class="fields">';$(required).each(function(e,f){if(f!==""&&f!==undefined){empty_note+='<div class="field">'+f+"</div>"}});empty_note+="</div>";notify(empty_note,5,"error","warning");breaker.push(1)}let invalid=validator(p,data);if(invalid.length>0){$(p).removeClass("load");$(c).attr("disabled",false).removeClass("load");let invalid_note=$(p).data("invalid")!==undefined?$(p).data("invalid"):"The highlighted fields seem to be invalid!";invalid_note+='<div class="fields invalid_fields">';$(invalid).each(function(f,e){let field_title=e[0];let reasons=e[1];if(reasons.length>0){$(reasons).each(function(g,h){let reasons_note='<div class="reason">'+h+"</div>";invalid_note+='<div class="invalid"><div class="field">'+field_title+"</div>"+reasons_note+"</div>"})}});invalid_note+="</div>";notify(invalid_note,99,"error","warning");breaker.push(1)}if(breaker.length>0){return}let d=get_values(p,data,pre);d.action=$(c).data("action")!==undefined?$(c).data("action"):($(p).data("t")!==undefined?$(p).data("t"):"");if($(p).data("t")!==""&&$(p).data("t")!==undefined){d.t=$(p).data("t")}if($(p).data("pre")!==""&&$(p).data("pre")!==undefined){d.pre=pre}let pos=$(p).data("post");if(pos!==undefined&&pos!==null){d.post=pos}if(d.action===undefined||d.action===null){elog("Action not set!")}let types=Array("id","by","action","h","d","dt","alerts","emails");$.each(types,function(e,f){if($(p).data(f)!==undefined&&$(p).data(f)!==""){d[f]=$(p).data(f)}});console.log(d);let validation=p.data("validation")!==""&&p.data("validation")!==undefined?p.data("validation"):"";let cb="";if(p.data("callback")!==""&&p.data("callback")!==undefined){cb="process_end,"+p.data("callback");d.callback=p.data("callback")}else{cb="process_end"}post(d.action,d,p.data("notify"),p.data("reload"),p.data("redirect"),0,cb,p.data("reset"),p,validation)}function process_end(c,b){$(c).removeClass("load").find('[onclick="process_data(this)"]').attr("disabled",false).removeClass("load");elog(c)}function edit_data(c,b){let t=$(c).data("t")?$($(c).data("t")):$(b);let data=$(c).data("data");if(!$(t).hasClass("on")){$(t).addClass("on")}$(b).hasClass("modal")?$("body").addClass("modal_open"):"";$(b).find("[data-add]").hide();$(b).find("[data-update],[data-edit]").show();elog(data);if(typeof data==="object"&&!Array.isArray(data)&&data!==null){$.each(data,function(e,f){if(f===null){return}if(e==="id"){t.data("id",f).find("[data-t]").data("id",f);$(t).hasClass("modal")?t.addClass("on"):""}else{let el=$(t).find("[data-key="+e+"]");if(el.attr("type")==="checkbox"){if(el.data("key")!==undefined){f=!$.isArray(f)?JSON.parse(f):[f];if($.isArray(f)){$(f).each(function(h,g){let s=$("[data-key="+e+"][value="+g+"]");f===1||f==="1"||f===true||f.length>0?s.prop("checked",true):s.prop("checked",false)})}else{f===1||f==="1"||f===true||f.length>0?el.prop("checked",true):el.prop("checked",false)}}else{let s=$("[data-key="+e+"][value="+f+"]");f===1||f==="1"||f===true||f.length>0?s.prop("checked",true):s.prop("checked",false)}}else{if(el.attr("type")==="radio"){let s=$("[data-key="+e+"][value="+f+"]");f==="1"||f===true||f.length>0?s.prop("checked",true):s.prop("checked",false)}else{if(el.prop("type")==="select-multiple"){$(el).val(f.split(", ")).trigger("change")}else{let tar="#"+e;if($(tar).length){$(tar).val(text_to_html(f)).trigger("change")}else{if(el.data("hidden-date")!==undefined){let date=new Date(f);$("#"+el.attr("id")+"_alt").val([("0"+date.getDate()).slice(-2),("0"+date.getMonth()).slice(-2),date.getFullYear()].join("-")).trigger("change")}el.val(text_to_html(f)).trigger("change")}}}}}})}typeof files_ui==="function"?files_ui():"";typeof file_ui==="function"?file_ui():""}function update_data(k,h,j,g,f,c,i,b){let data={action:h,target:j,keys:g,values:f,logic:c};let con=$(k).data("confirm");let n=i!==undefined&&i!==""?i:2;let r=b!==undefined&&b!==""?b:2;if(con!==undefined&&con!==""){if(!confirm(con)){return}}post(h,data,n,r)}function trash_data(i,f,h,c,g,b){let data={action:f,target:h,logic:c};let con=$(i).data("confirm");let n=g!==undefined&&g!==""?g:2;let r=b!==undefined&&b!==""?b:2;if(con!==undefined&&con!==""){if(!confirm(con)){return}}post(f,data,n,r)}function post(action,data,notify_time,reload_time,redirect,redirect_time,callback,reset,p,validation){if(validation!==undefined&&validation!==""){let validations=validation.split(",");let invalid=[];$.each(validations,function(i,v_func){let vr=eval(v_func+"("+JSON.stringify(data)+")");if(!vr){invalid.push(1)}});if(invalid.length>0){return}}let d=$.extend({},{action:action},data);$.post(location.origin,d,function(r){try{elog(r);r=JSON.parse(r);elog(r);elog(notify_time);if(notify_time!==undefined&&notify_time!==""){elog(r);elog($(p).data("success"));if(r[0]===1&&$(p).data("success")!==undefined){notify($(p).data("success"),notify_time,"","check_circle")}else{notify(r[1],notify_time,"error","error")}}if(r[0]!==0&&reload_time!==undefined&&reload_time!==""&&reload_time!=="0"){$.isNumeric(reload_time)?setTimeout(function(){location.reload()},reload_time*1000):location.href=reload_time}if(r[0]!==0&&reset!==undefined&&reset!==""&&reset!=="0"){$("[data-"+reset+"]").val("")}if(redirect!==undefined&&redirect!==""){redirect_time=redirect_time!==undefined&&redirect_time!==""?redirect_time:reload_time;if(r[0]!==0){setTimeout(function(){location.href=redirect},redirect_time*1000)}}elog(callback);if(callback!==undefined&&callback!==""){let calls=callback.split(",");$.each(calls,function(i,call){eval(call+"("+JSON.stringify(r)+")")})}}catch(rat){if(callback!==undefined&&callback!==""){callback=callback.split(",");$.each(callback,function(i,call){eval(call+"("+JSON.stringify(r)+")")})}}})}function html_to_text(b){let map={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return b.replace(/[&<>"']/g,function(c){return map[c]})}function text_to_html(b){let map={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};console.log(b);return typeof b=="string"?b.replaceAll(/&amp;|&lt;|&gt;|&quot;|&#039;/g,function(c){return map[c]}):b}function redirect(b){elog(b)}function reload(b){let t=b!==undefined&&b!==""?b*1000:5000;setTimeout(function(){location.reload()},t)};