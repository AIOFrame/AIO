let STRIPE_PUBLISHABLE_KEY=$("[data-stripe-public-key]").data("stripe-public-key");const stripe=Stripe(STRIPE_PUBLISHABLE_KEY);const subscrFrm=$("#subscription_form");subscrFrm.addEventListener("submit",handleSubscrSubmit);let elements=stripe.elements();let ir=$($("[type=text]")[0]);let style={base:{iconColor:ir.css("color"),border:ir.css("border"),height:ir.css("height"),borderRadius:ir.css("border-radius"),color:ir.css("color"),fontWeight:ir.css("font-weight"),fontFamily:ir.css("font-family"),fontSize:ir.css("font-size"),backgroundColor:ir.css("background-color"),letterSpacing:ir.css("letter-spacing"),fontSmoothing:"antialiased",padding:ir.css("padding")},invalid:{iconColor:"firebrick",color:"firebrick"}};let cardElement=elements.create("card",{style:style});cardElement.mount("#card-element");cardElement.on("change",function(a){displayError(a)});function displayError(a){if(a.error){notify(a.error.message)}}function handleSubscrSubmit(a){a.preventDefault();setLoading(true);let plan_id=$("[data-key=plan]").val();let customer_name=$("[data-key=name]").val();let customer_email=$("[data-key=email]").val();fetch(location.origin,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request_type:"create_customer_subscription",plan_id:plan_id,name:customer_name,email:customer_email})}).then(function(b){b.json()}).then(function(b){if(b.subscriptionId&&b.clientSecret){paymentProcess(b.subscriptionId,b.clientSecret,b.customerId)}else{notify(b.error)}setLoading(false)}).catch(console.error)}function paymentProcess(b,a,c){setProcessing(true);let plan_id=$("[data-key=plan]").val();let customer_name=$("[data-key=name]").val();stripe.confirmCardPayment(a,{payment_method:{card:cardElement,billing_details:{name:customer_name}}}).then(function(d){if(d.error){notify(d.error.message);setProcessing(false);setLoading(false)}else{fetch(location.origin,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request_type:"payment_insert",subscription_id:b,customer_id:c,plan_id:plan_id,payment_intent:d.paymentIntent})}).then(function(e){e.json()}).then(function(e){if(e.payment_id){alert(e.payment_id);console.log(e.payment_id)}else{notify(e.error);setProcessing(false);setLoading(false)}}).catch(console.error)}})}function setLoading(a){if(a){$("#submit_button").attr("disabled",true);$("#spinner").removeClass("dn");$("#buttonText").addClass("dn")}else{$("#submit_button").attr("disabled",false);$("#spinner").addClass("dn");$("#buttonText").removeClass("dn")}}function setProcessing(a){if(a){$(subscrFrm).addClass("dn");$("#frmProcess").removeClass("dn")}else{$(subscrFrm).removeClass("dn");$("#frmProcess").addClass("dn")}};